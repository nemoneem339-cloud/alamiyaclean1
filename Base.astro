---
/**
 * Base Layout - Enhanced for Performance
 * =======================================
 * القالب الأساسي لجميع الصفحات
 * يحتوي على Header و Footer و SEO
 * محسّن للسرعة وإمكانية الوصول
 * 
 * الاستخدام:
 * ---
 * import Base from '../layouts/Base.astro';
 * ---
 * <Base title="عنوان الصفحة" description="وصف الصفحة">
 *   <!-- محتوى الصفحة -->
 * </Base>
 */

import SEOHead from '../components/SEOHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  image?: string;
}

const { title, description, image } = Astro.props;
---

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <SEOHead title={title} description={description} image={image} />
  
  <!-- Speculation Rules for Prefetch (Chrome 121+) -->
  <script type="speculationrules">
  {
    "prefetch": [
      { "where": { "href_matches": "/*" }, "eagerness": "moderate" }
    ],
    "prerender": [
      { "where": { "selector_matches": "a[href='/services'], a[href='/contact']" }, "eagerness": "moderate" }
    ]
  }
  </script>
</head>
<body class="font-sans bg-slate-50 text-slate-900 antialiased">
  
  <!-- Skip to Content for Accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:right-4 focus:z-50 focus:bg-primary focus:text-white focus:px-4 focus:py-2 focus:rounded-lg">
    انتقل للمحتوى الرئيسي
  </a>
  
  <Header />

  <Breadcrumbs />
  
  <main id="main-content" class="min-h-screen">
    <slot />
  </main>
  
  <Footer />
  
  <!-- Performance: Lazy load non-critical scripts -->
  <script>
    // Intersection Observer for lazy animations
    if ('IntersectionObserver' in window) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });
      
      document.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));
    }
  </script>
  
  <!-- Google Analytics - Replace GA_MEASUREMENT_ID with your actual ID -->
  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'GA_MEASUREMENT_ID');
  </script>
  -->
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('✅ Service Worker مسجّل'))
          .catch(err => console.log('❌ فشل تسجيل SW:', err));
      });
    }
  </script>
  
</body>
</html>

